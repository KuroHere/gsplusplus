/*
 * Decompiled with CFR 0.152.
 */
package com.gamesense.client.module.modules.exploits;

import com.gamesense.api.event.events.DamageBlockEvent;
import com.gamesense.api.event.events.PacketEvent;
import com.gamesense.api.event.events.PlayerMoveEvent;
import com.gamesense.api.setting.values.BooleanSetting;
import com.gamesense.api.util.misc.MessageBus;
import com.gamesense.api.util.player.InventoryUtil;
import com.gamesense.api.util.player.RotationUtil;
import com.gamesense.client.module.Category;
import com.gamesense.client.module.Module;
import java.util.function.Predicate;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.block.Block;
import net.minecraft.init.Blocks;
import net.minecraft.init.Items;
import net.minecraft.item.Item;
import net.minecraft.item.ItemAxe;
import net.minecraft.item.ItemSword;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketConfirmTeleport;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.server.SPacketPlayerPosLook;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.EnumHand;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.Vec2f;
import net.minecraft.util.math.Vec3d;
import net.minecraft.util.math.Vec3i;
import net.minecraft.world.World;

@Module.Declaration(name="MiningSpoof", category=Category.Exploits)
public class MiningSpoof
extends Module {
    boolean noPick;
    BooleanSetting ignoreAxe = this.registerBoolean("IgnoreAxe", false);
    BooleanSetting ignoreSword = this.registerBoolean("IgnoreSword", false);
    BooleanSetting credits = this.registerBoolean("Credits", false);
    @EventHandler
    private final Listener<PlayerMoveEvent> eventListener = new Listener<PlayerMoveEvent>(event -> {
        if (MiningSpoof.mc.field_71439_g == null || !MiningSpoof.mc.field_71474_y.field_74312_F.func_151470_d()) {
            return;
        }
        try {
            if (MiningSpoof.mc.field_71441_e.func_180495_p(MiningSpoof.mc.field_71476_x.func_178782_a()).func_185887_b((World)MiningSpoof.mc.field_71441_e, MiningSpoof.mc.field_71476_x.func_178782_a()) <= 0.0f) {
                this.noPick = true;
                return;
            }
            if (!this.shouldMineSpoof()) {
                return;
            }
            int pickSlot = MiningSpoof.getPickaxeSlot();
            if (pickSlot == -1) {
                this.noPick = true;
                return;
            }
            if (pickSlot == MiningSpoof.mc.field_71439_g.field_71071_by.field_70461_c) {
                return;
            }
            this.noPick = false;
            int oldSlot = MiningSpoof.mc.field_71439_g.field_71071_by.field_70461_c;
            MiningSpoof.mc.field_71439_g.field_71071_by.field_70461_c = pickSlot;
            MiningSpoof.mc.field_71442_b.func_78765_e();
            MiningSpoof.mc.field_71439_g.func_184609_a(EnumHand.MAIN_HAND);
            MiningSpoof.mc.field_71442_b.func_180512_c(MiningSpoof.mc.field_71476_x.func_178782_a(), MiningSpoof.mc.field_71476_x.field_178784_b);
            MiningSpoof.mc.field_71439_g.field_71071_by.field_70461_c = oldSlot;
            MiningSpoof.mc.field_71442_b.func_78765_e();
        }
        catch (Exception exception) {
            // empty catch block
        }
    }, new Predicate[0]);
    @EventHandler
    private final Listener<DamageBlockEvent> playerDamageBlockEvent = new Listener<DamageBlockEvent>(event -> {
        if (MiningSpoof.mc.field_71439_g.field_71071_by.field_70461_c != MiningSpoof.getPickaxeSlot() && !this.noPick && this.shouldMineSpoof()) {
            event.cancel();
        }
    }, new Predicate[0]);

    @Override
    protected void onEnable() {
        if (((Boolean)this.credits.getValue()).booleanValue()) {
            MessageBus.sendClientPrefixMessageWithID("SRC from CookieClient at https://github.com/bebeli555/CookieClient/blob/main/src/main/java/me/bebeli555/cookieclient/mods/exploits/MiningSpoof.java", MiningSpoof.getIdFromString("SRC from CookieClient at https://github.com/bebeli555/CookieClient/blob/main/src/main/java/me/bebeli555/cookieclient/mods/exploits/MiningSpoof.java"));
        }
    }

    @Override
    protected void onDisable() {
        this.noPick = false;
    }

    public boolean shouldMineSpoof() {
        Block[] dontMine;
        Item held = MiningSpoof.mc.field_71439_g.func_184614_ca().func_77973_b();
        if (((Boolean)this.ignoreAxe.getValue()).booleanValue() && held instanceof ItemAxe || ((Boolean)this.ignoreSword.getValue()).booleanValue() && held instanceof ItemSword) {
            return false;
        }
        for (Block block : dontMine = new Block[]{Blocks.field_150321_G}) {
            if (block != MiningSpoof.mc.field_71441_e.func_180495_p(MiningSpoof.mc.field_71476_x.func_178782_a()).func_177230_c()) continue;
            return false;
        }
        return true;
    }

    public static int getPickaxeSlot() {
        Item[] picks;
        for (Item pick : picks = new Item[]{Items.field_151046_w, Items.field_151005_D, Items.field_151035_b, Items.field_151050_s, Items.field_151039_o}) {
            if (InventoryUtil.findFirstItemSlot(pick.getClass(), 0, 8) == -1) continue;
            return InventoryUtil.findFirstItemSlot(pick.getClass(), 0, 8);
        }
        return -1;
    }

    public static class CancelForceRotation {
        public static CancelForceRotation instance = new CancelForceRotation();
        @EventHandler
        private final Listener<PacketEvent.Send> packetEvent = new Listener<PacketEvent.Send>(event -> {
            if (mc.field_71439_g == null) {
                return;
            }
            if (event.getPacket() instanceof SPacketPlayerPosLook) {
                event.cancel();
                SPacketPlayerPosLook packet = (SPacketPlayerPosLook)event.getPacket();
                mc.field_71439_g.func_70107_b(packet.func_148932_c(), packet.func_148928_d(), packet.func_148933_e());
                mc.field_71439_g.field_70181_x = 0.0;
                Vec2f rotations = RotationUtil.getRotationTo(new Vec3d((Vec3i)new BlockPos(mc.field_71439_g.func_174791_d()).func_177982_a(0, -1, 0)).func_72441_c(0.5, 0.5, 0.5).func_178787_e(new Vec3d(EnumFacing.UP.func_176730_m()).func_186678_a(0.5)));
                mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketConfirmTeleport(packet.func_186965_f()));
                mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayer.PositionRotation(mc.field_71439_g.field_70165_t, mc.field_71439_g.func_174813_aQ().field_72338_b, mc.field_71439_g.field_70161_v, rotations.field_189982_i, rotations.field_189983_j, false));
            }
        }, new Predicate[0]);
    }
}

