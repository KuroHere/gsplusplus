/*
 * Decompiled with CFR 0.152.
 */
package com.gamesense.client.module.modules.exploits;

import com.gamesense.api.event.events.PacketEvent;
import com.gamesense.api.setting.values.BooleanSetting;
import com.gamesense.api.setting.values.IntegerSetting;
import com.gamesense.client.module.Category;
import com.gamesense.client.module.Module;
import java.util.function.Predicate;
import me.zero.alpine.listener.EventHandler;
import me.zero.alpine.listener.Listener;
import net.minecraft.entity.Entity;
import net.minecraft.item.ItemBow;
import net.minecraft.item.ItemEgg;
import net.minecraft.item.ItemEnderPearl;
import net.minecraft.item.ItemSnowball;
import net.minecraft.item.ItemStack;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.client.CPacketPlayerDigging;
import net.minecraft.network.play.client.CPacketPlayerTryUseItem;
import net.minecraft.util.EnumHand;

@Module.Declaration(name="BowExploit", category=Category.Exploits)
public class BowExploit
extends Module {
    BooleanSetting Bows = this.registerBoolean("Bows", true);
    BooleanSetting pearls = this.registerBoolean("Pearls", true);
    BooleanSetting eggs = this.registerBoolean("Eggs", true);
    BooleanSetting snowballs = this.registerBoolean("Snowballs", true);
    IntegerSetting Timeout = this.registerInteger("Timeout", 5000, 100, 2000);
    IntegerSetting spoofs = this.registerInteger("Spoofs", 10, 1, 300);
    BooleanSetting bypass = this.registerBoolean("Bypass", false);
    private long lastShootTime;
    @EventHandler
    private final Listener<PacketEvent.Send> onUpdate = new Listener<PacketEvent.Send>(event -> {
        ItemStack handStack;
        CPacketPlayerTryUseItem packet2;
        if (event.getPacket() instanceof CPacketPlayerDigging) {
            ItemStack handStack2;
            CPacketPlayerDigging packet = (CPacketPlayerDigging)event.getPacket();
            if (packet.func_180762_c() == CPacketPlayerDigging.Action.RELEASE_USE_ITEM && !(handStack2 = BowExploit.mc.field_71439_g.func_184586_b(EnumHand.MAIN_HAND)).func_190926_b() && handStack2.func_77973_b() instanceof ItemBow && ((Boolean)this.Bows.getValue()).booleanValue()) {
                this.doSpoofs();
            }
        } else if (event.getPacket() instanceof CPacketPlayerTryUseItem && (packet2 = (CPacketPlayerTryUseItem)event.getPacket()).func_187028_a() == EnumHand.MAIN_HAND && !(handStack = BowExploit.mc.field_71439_g.func_184586_b(EnumHand.MAIN_HAND)).func_190926_b()) {
            if (handStack.func_77973_b() instanceof ItemEgg && ((Boolean)this.eggs.getValue()).booleanValue()) {
                this.doSpoofs();
            } else if (handStack.func_77973_b() instanceof ItemEnderPearl && ((Boolean)this.pearls.getValue()).booleanValue()) {
                this.doSpoofs();
            } else if (handStack.func_77973_b() instanceof ItemSnowball && ((Boolean)this.snowballs.getValue()).booleanValue()) {
                this.doSpoofs();
            }
        }
    }, new Predicate[0]);

    @Override
    public void onEnable() {
        if (this.isEnabled()) {
            this.lastShootTime = System.currentTimeMillis();
        }
    }

    private void doSpoofs() {
        if (System.currentTimeMillis() - this.lastShootTime >= (long)((Integer)this.Timeout.getValue()).intValue()) {
            this.lastShootTime = System.currentTimeMillis();
            BowExploit.mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketEntityAction((Entity)BowExploit.mc.field_71439_g, CPacketEntityAction.Action.START_SPRINTING));
            for (int index = 0; index < (Integer)this.spoofs.getValue(); ++index) {
                if (((Boolean)this.bypass.getValue()).booleanValue()) {
                    BowExploit.mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayer.Position(BowExploit.mc.field_71439_g.field_70165_t, BowExploit.mc.field_71439_g.field_70163_u + 1.0E-10, BowExploit.mc.field_71439_g.field_70161_v, false));
                    BowExploit.mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayer.Position(BowExploit.mc.field_71439_g.field_70165_t, BowExploit.mc.field_71439_g.field_70163_u - 1.0E-10, BowExploit.mc.field_71439_g.field_70161_v, true));
                    continue;
                }
                BowExploit.mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayer.Position(BowExploit.mc.field_71439_g.field_70165_t, BowExploit.mc.field_71439_g.field_70163_u - 1.0E-10, BowExploit.mc.field_71439_g.field_70161_v, true));
                BowExploit.mc.field_71439_g.field_71174_a.func_147297_a((Packet)new CPacketPlayer.Position(BowExploit.mc.field_71439_g.field_70165_t, BowExploit.mc.field_71439_g.field_70163_u + 1.0E-10, BowExploit.mc.field_71439_g.field_70161_v, false));
            }
        }
    }
}

